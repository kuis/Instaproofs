"use strict";

var BaseModel = require('app/base/base-model');
var BaseCollection = require('app/base/base-collection');

var app = require('app');

var State = BaseModel.extend({
  props: {
    id: 'number',
    name: 'string',
  },
});

var States = BaseCollection.extend({
  model: State,
  
  initialize: function (models, options) {
    this.url = app.apiUrl +'checkout/states/'+ options.code;
    this.fetch();
  },
});

module.exports = BaseModel.extend({
  props: {
    byCountryCode: ['object', true], 
  },
  
  getStates: function (countryCode, callback, context) {
    if (this.byCountryCode[countryCode]) {
      callback.call(context, this.byCountryCode[countryCode]);
    }
    else {
      this.byCountryCode[countryCode] = new States([], { code: countryCode });
      this.listenToOnce(this.byCountryCode[countryCode], 'sync', function () {
        callback.call(context, this.byCountryCode[countryCode]);
      });
    }
  },
});

