/*==========================================================================*\
  Purchase option in the buy form
\*==========================================================================*/
.purchase-option {
  // background-color: rgba(255,255,255,0.9);
  display: none;
  // opacity: 0;
  // pointer-events: none;
  &.displayed { 
    display: block;
    // opacity: 1;
    // pointer-events: auto;
  }
    
}
.purchase-option, .product-option {
  
  width: 100%;
  height: 44px;
  // overflow: hidden;
  border-top: rgba(0,0,0,0.1) 1px dashed;
  // &:first-child {
  //   border-top: none;
  // }
  
  // &.selected {
  //   // background: rgba(0,0,0, .1);
  //   // background: fadeout(@active, 90%);
  //   .head > .crop {
  //     color: @highlighted;
  //   }
  // }
  &.custom-crop {
    // background: rgba(0,0,0, .1);
    // background: fadeout(@active, 90%);
    .head > .crop:after {
      color: @highlighted;
    }
  }
  
  .cropping-mode & {
    opacity: .2;
    pointer-events: none;
    &.selected {
      opacity: 1;
      pointer-events: auto;
    }
  }
  
  position: absolute;
  top: 0;
  left: 0;
  
  transition: opacity 200ms, transform 300ms;
  
  .instant-positioning & {
    transition: none;
  }
  
  &.product-size {
    position: static;
    .head {
      padding-left: 30px;
      padding-right: 14px;
    }
    .qty {
      margin-left: 15px;
    }
    &.fulfilled .spots-left {
      color: @active !important;
    }
    &.over-capacity .spots-left {
      color: @highlighted !important;
    }
    // &.fulfilled {
    //   display: none;
    //   &.active {
    //     display: block;
    //   }
    // }
  }
  
  .head {
    display: flex;
    align-items: center;
    height: 44px;
    line-height: 44px;
    padding: 0 15px;
    
    // .buy-form-fullscreen & {
    //   padding-top: 44px;
    // }
    
    > .name {
      flex-grow: 1;
      text-align: left;
      
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 5px;
      
      > .full-name { display: none; }
      
      .spots-left {
        color: @grey-text;
        &:before { content: '('; }
        &:after { content: ')'; }
        margin-left: 7px;
        font-weight: 300;
      }
      // .buy-form-fullscreen & {
      //   position: absolute;
      //   top: 0;
      //   left: 0;
      //   right: 0;
        
      //   > .full-name { display: inline; }
      //   > .short-name { display: none; }
      // }
      
      
      > .info {
        padding: 10px 5px;
        margin-left: 3px;
        
        cursor: pointer;
        font-size: 16px;
        vertical-align: -2px;
        
        color: rgba(0,0,0,.7);
        .desktop-ua &:hover { color: rgba(0,0,0,1); }
        .dark-mode & {
          color: rgba(255,255,255,.4);
          .desktop-ua&:hover { color: rgba(255,255,255,1); }
        }
        
        &:extend(.icon);
        &:after {
          &:extend(.icon.info);
        }
        
        // .desktop-ua & {
        //   opacity: 0;
        //   transition: opacity 200ms 200ms;
        // }
        // .desktop-ua :hover& {
        //   opacity: 1;
        //   transition: opacity 200ms 300ms;
        // }
      }
    }
    
    > .bulk-pricing {
      display: none;
      // display: inline-block;
      background: @grey-lines;
      color: @almost-black;
      position: relative;
      
      .bulk-pricing-available& { display: inline-block; }
      .bulk-pricing-active& { 
        background: @active;
        color: @white;
      }
      
      font: bold 12px/14px @sans;
      // height: 18px;
      padding: 3px 6px;
      border-radius: 10px;
      vertical-align: super;
      margin-left: 4px;
      
      &:before {
        &:extend(.icon);
        &:extend(.icon.stack-picture);
        vertical-align: -1px;
      }
      &:after {
        // content: '%';
        margin-left: 2px;
        // font-size: 13px;
        // vertical-align: -1px;
      }
      
      .desktop-ua &:hover > .bulk-tip {
        display: block;
      }
      > .bulk-tip {
        display: none;
        
        position: absolute;
        left: -10px;
        top: -4px;
        height: 26px;
        padding: 0 10px;
        border-radius: 2px;
        transform: translateX(-100%);
        
        font: 300 14px/26px @sans;
        white-space: nowrap;
        
        color: @white;
        background: rgba(0,0,0,0.7);
        background: @highlighted;
        
        &:after {
          content: '';
          display: block;
          position: absolute;
          top: 8px;
          right: -5px;
          width: 0; 
          height: 0; 
          border-top: 5px solid transparent;
          border-bottom: 5px solid transparent;
          
          border-left: 5px solid rgba(0,0,0,0.7);
          border-left: 5px solid @highlighted;
        }
      }
    }
    
    > .discount {
      display: none;
      .discounted& { display: inline-block; }
      // background: @highlighted;
      background: @active;
      color: @white;
      font: bold 12px/14px @sans;
      // height: 18px;
      padding: 3px;
      border-radius: 10px;
      vertical-align: super;
      margin-left: 4px;
    }
    
    > .crop {
      // opacity: 0;
      transition: opacity 300ms, transform 300ms;
      // transform: translateY(-44px);
      
      cursor: pointer;
      
      .buy-form-fullscreen .qty-input-mode& {
        opacity: 0;
      }
      
      background: rgba(0,0,0,0.5);
      background: @active;
      background: center/cover no-repeat;
      
      height: 32px;
      margin-left: 15px;
      .dark-mode & { 
        box-shadow: inset 0 0 0 1px rgba(255,255,255,1);
        box-shadow: none;
        box-sizing: border-box;
        border: #777 1px solid;
      }
      // .dark-mode & { box-shadow: none; }
      
      > .borders {
        &:extend(.fill);
        box-shadow: inset 0 0 0 1px rgba(0,0,0,.1);
      }
      
      position: relative;
      
      .buy-form-fullscreen & {
        margin-right: 15px;
      }
      
      .desktop-ua &:hover > .crop-tip {
        display: block;
      }
      .cropping-mode & .crop-tip {
        display: none !important;
      }
      > .crop-tip {
        display: none;
        
        position: absolute;
        left: -10px;
        top: 3px;
        height: 26px;
        padding: 0 10px;
        border-radius: 2px;
        transform: translateX(-100%);
        
        font: 300 14px/26px @sans;
        white-space: nowrap;
        
        color: @white;
        background: rgba(0,0,0,0.7);
        background: @highlighted;
        
        &:after {
          content: '';
          display: block;
          position: absolute;
          top: 8px;
          right: -5px;
          width: 0; 
          height: 0; 
          border-top: 5px solid transparent;
          border-bottom: 5px solid transparent;
          
          border-left: 5px solid rgba(0,0,0,0.7);
          border-left: 5px solid @highlighted;
        }
      }
      
      .crop-covers {
        &:extend(.fill);
        overflow: hidden;
      }
      .crop-cover {
        &:extend(.fill);
        // position: absolute;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,.8);
        background: rgba(100,100,100,.9);
        // background: @white;
        // background: #777;
        // .dark-mode & { background: @highlighted; }
        .dark-mode & { background: rgba(0,0,0,.9); }
        // background: @highlighted;
        
        &.top { top: -100%; bottom: auto; }
        &.right { left: 100%; right: auto; }
        &.bottom { top: 100%; bottom: auto; }
        &.left { left: -100%; right: auto; }
      }
      
      .desktop-ua &:hover .crop-cover {
        background: @highlighted;
      }
    }
    
    .checkbox {
      cursor: pointer;
      width: 34px;
      height: 32px;
      text-align: center;
      box-sizing: border-box;
      border: #ccc 1px solid;
      border-radius: 3px;
      
      .product-size& {
        margin-left: 15px;
        margin-right: 16px;
      }
      
      &:after {
        &:extend(.icon);
        display: block;
        width: 32px;
        height: 30px;
        font-size: 14px;
        line-height: 30px;
      }
    }
    
    .qty {
      width: 100px;
      flex-shrink: 0;
      .buy-form-fullscreen & {
        width: 35px;
      }
      height: 32px;
      position: relative;
      text-align: right;
      box-sizing: border-box;
      border: #ccc 1px solid;
      border-radius: 3px;
      
      // width: 136px;
      // height: 44px;
      // border: none;
      // border-left: rgba(0,0,0,0.1) 1px dashed;
      // border-right: rgba(0,0,0,0.1) 1px dashed;
      // border-radius: 0;
      
      input {
        -moz-appearance: textfield;
        -webkit-appearance: none;
        display: inline-block;
        width: 32px;
        height: 30px;
        padding: 0;
        margin: 0;
        border: none;
        // border-right: none;
        
        position: absolute;
        top: 0;
        left: 0;
        
        &, &[disabled] {
          color: @black !important;
        }
        background: none;
        outline: 0 none;
        font: normal 14px @sans;
        
        text-align: center;
        
        &::-webkit-outer-spin-button,
        &::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
      }
        
      .plus, .minus {
        cursor: pointer;
        display: inline-block;
        width: 32px;
        height: 30px;
        border-left: #ccc 1px solid;
        position: relative;
        background: rgba(0,0,0,0.05);
        background: rgba(0,0,0,0.0);
        .desktop-ua &:hover { background: rgba(0,0,0,.1); }
        
        // width: 44px;
        // height: 44px;
        // border-left: rgba(0,0,0,0.1) 1px dashed;
        // box-shadow: inset 0 0 3px 0 rgba(0,0,0,.2);
        
        &:before {
          content: '';
          width: 10px;
          height: 2px;
          display: block;
          position: absolute;
          top: 14px;
          left: 11px;
          background: lighten(@black, 30%);
          
          // top: 20px;
          // left: 16px;
        }
      }
      .plus:after {
        content: '';
        height: 10px;
        width: 2px;
        display: block;
        position: absolute;
        top: 10px;
        left: 15px;
        background: lighten(@black, 30%);
        
        // top: 16px;
        // left: 20px;
      }
      
      .buy-form-fullscreen & {
        input {
          cursor: pointer;
          // pointer-events: none;
        }
        .plus, .minus {
          visibility: hidden;
          opacity: 0;
          transition: opacity 300ms;
          background: #eee;
          border-top: #ccc 1px solid;
          border-bottom: #ccc 1px solid;
          position: absolute;
          width: 42px;
          top: -1px;
          &:before {
            left: 16px;
          }
        }
        .plus {
          left: -44px;
          &:after {
            left: 20px;
          }
        }
        .minus {
          left: -87px;
        }
        // visibility: hidden;
      }
      .buy-form-fullscreen .qty-input-mode& {
        .plus, .minus {
          visibility: visible;
          opacity: 1;
        }
      }
    }
    
    .price {
      width: 50px;
      text-align: right;
      // font-family: @mono;
      
      &.single {
        width: 60px;
        margin-right: 15px;
        // .discounted& { color: @highlighted; font-weight: bold; }
        .buy-form-fullscreen &, .product-size& {
          display: none;
        }
        
        .bulk-compound.bulk-pricing-active& {
          > .original-price { display: inline; }
          > .discounted-price { display: none; }
          // visibility: hidden;
        }
      }
      &.final {
        margin-left: 15px;
        text-align: left;
        opacity: .5;
        .product-size& {
          visibility: hidden;
          display: none;
        }
      }
      
      > .original-price, .base-final-price {
        text-decoration: line-through;
        display: none;
      }
      .desktop-ua .discounted&:hover, .desktop-ua .bulk-pricing-active&:hover {
        cursor: auto;
        > .original-price { display: inline; }
        > .discounted-price { display: none; }
      }
      .desktop-ua .discounted.active&:hover,
      .desktop-ua .bulk-pricing-active&:hover {
        cursor: auto;
        > .base-final-price { display: inline; }
        > .discounted-final-price { display: none; }
      }
    }
  }
  
  .addons, .wrap {
    transform-origin: top center;
    transform: scaleY(0);
    // transform: translateY(-100%);
    transition: transform 200ms ease-in, opacity 400ms ease-out;
    opacity: 0;
    
    padding: 0 185px 2px 30px;
    .no-qty& {
      padding-right: 119px;
    }
    
    .buy-form-fullscreen &,  .buy-form-fullscreen .no-qty& {
      padding-right: 70px;
      padding-left: 0;
    }
    
    text-align: right;
    
    display: flex;
    flex-flow: column nowrap;
    align-items: flex-end;
    justify-content: flex-end;
    
  }
  
  &.active {
    .head .name, .head .price.final {
      color: @highlighted;
      font-weight: bold;
      opacity: 1;
    }
    .head .checkbox:after {
      &:extend(.icon.check);
    }
    &.has-addons .addons, .wrap {
      transform: scaleY(1);
      transition: transform 300ms ease-out, opacity 400ms ease-in;
      // transform: translateY(0);
      opacity: 1;
    }
    
    .crop {
      opacity: 1;
      // transform: translateY(0);
    }
  }
  
  &.no-qty {
    .head {
      cursor: pointer;
      .desktop-ua &:hover {
        background: rgba(0,0,0,.1);
        .dark-mode& { background: #191919; }
      }
    }
  }
  
  .addons {
    padding: 0 15px 2px 30px;
    .no-qty& {
      padding-right: 15px;
    }
  }
}

.dark-mode .purchase-option {
  border-top: rgba(255,255,255,0.1) 1px dashed;
  &:first-child {
    border-top: none;
  }
}
.dark-mode .purchase-option .head .qty {
  border: #333 1px solid;
  input {
    &, &[disabled] {
      color: @white !important;
    }
  }
  .plus, .minus {
    border-left: #333 1px solid;
    background: rgba(255,255,255,0.05);
    .desktop-ua&:hover { background: rgba(255,255,255,.1); }
    
    &:before {
      background: darken(@white, 30%);
    }
  }
  .plus:after {
    background: darken(@white, 30%);
  }
}
